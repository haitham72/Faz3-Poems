<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ¥ÿπÿ±</title>
    <script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js"></script>
    <style>
      :root {
        --bg: #f9fafb;
        --card: #fff;
        --accent: #ffd54f;
        --border: #e8e8e8;
        --text: #111;
        --muted: #666;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Naskh Arabic", "Segoe UI", Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        direction: rtl;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .status {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 16px;
      }

      .search-bar {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      input {
        flex: 1;
        padding: 14px 16px;
        border: 1px solid var(--border);
        border-radius: 10px;
        font-size: 17px;
        background: white;
      }

      button {
        padding: 10px 16px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: white;
        cursor: pointer;
        font-size: 14px;
      }

      button:hover {
        background: #f5f5f5;
      }

      .results {
        margin-top: 16px;
      }

      .result {
        background: white;
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .result:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
      }

      .title {
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .poem-lines {
        line-height: 1.9;
        font-size: 16px;
        color: var(--text);
        font-family: "Noto Naskh Arabic", "Traditional Arabic", serif;
      }

      .poetry-line {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 4px;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }

      .hemistich {
        text-align: justify;
        word-spacing: 0.05em;
      }

      .hemistich-right {
        text-align-last: right;
      }

      .hemistich-left {
        text-align-last: left;
      }

      mark {
        background: var(--accent);
        padding: 2px 4px;
        border-radius: 3px;
        font-weight: 600;
      }

      .meta {
        margin-top: 10px;
        font-size: 12px;
        color: var(--muted);
      }

      .badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        background: #e3f2fd;
        color: #1976d2;
        font-size: 11px;
        margin-left: 4px;
      }

      .no-results {
        text-align: center;
        padding: 40px;
        color: var(--muted);
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ¥ÿπÿ±</h1>
      <div class="status" id="status">ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>

      <div class="search-bar">
        <input
          id="searchInput"
          type="search"
          placeholder="ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ£Ÿà ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° (ŸÖÿ´ÿßŸÑ: ŸÖÿ≠ŸÖÿØÿå ÿ≠ÿ®ÿå ÿØÿ®Ÿä)"
          disabled
        />
        <button id="clearBtn" disabled>ŸÖÿ≥ÿ≠</button>
      </div>

      <div id="results" class="results"></div>
    </div>

    <script>
      // ============================================================
      // CONFIG
      // ============================================================
      const CSV_FILE = "02 - Exact_search.csv";
      const DEBOUNCE_MS = 150;

      // Boosted words for priority matching
      const BOOSTED_WORDS = [
        // Immediate Family & Close Relations
        "ŸÖÿ≠ŸÖÿØ",
        "ÿ±ÿßÿ¥ÿØ",
        "ÿ≤ÿßŸäÿØ",
        "ŸáŸÜÿØ",
        "ÿ¥ŸäÿÆÿ©",
        "ŸÖŸÉÿ™ŸàŸÖ",
        "ÿ£ÿ≠ŸÖÿØ",
        "ÿ≠ŸÖÿØÿßŸÜ",
        "ŸÅŸÑÿ∞ÿ©",
        "ŸÜŸàÿ±",
        "ÿ≠ÿ®Ÿäÿ®Ÿä",
        "ÿ£ŸÖŸä",
        "ÿ£ÿ®Ÿä",
        "ÿßÿ®ŸÜŸä",
        "ÿßÿ®ŸÜÿ™Ÿä",
        "ÿ£ÿÆŸä",
        "ÿ®ŸÜÿ™Ÿä",
        "ÿßÿ®ŸÜÿ™Ÿä",
        "ŸÅÿ±ÿ≠ÿ™Ÿä",

        // Leadership & Founding Fathers
        "ÿ®Ÿà ÿÆÿßŸÑÿØ",
        "MBZ",
        "ÿÆŸÑŸäŸÅÿ©",
        "ÿ≥ÿπŸàÿØ",
        "ÿµŸÇÿ±",
        "ÿ≠ŸÖŸäÿØ",
        "ÿ±ÿßÿ¥ÿØ ÿ®ŸÜ ÿ≥ÿπŸäÿØ",
        "ŸÖŸÉÿ™ŸàŸÖ ÿ®ŸÜ ÿ±ÿßÿ¥ÿØ",
        "ÿ≤ÿßŸäÿØ ÿ®ŸÜ ÿ≥ŸÑÿ∑ÿßŸÜ",
        "ÿ≠ÿßŸÉŸÖ ÿØÿ®Ÿä",
        "ÿ≠ÿßŸÉŸÖ ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä",
        "ÿ≠ÿßŸÉŸÖ ÿßŸÑÿ¥ÿßÿ±ŸÇÿ©",
        "ÿ≠ÿßŸÉŸÖ ÿßŸÑŸÅÿ¨Ÿäÿ±ÿ©",
        "ÿ≠ÿßŸÉŸÖ ÿ±ÿ£ÿ≥ ÿßŸÑÿÆŸäŸÖÿ©",
        "ÿ≠ÿßŸÉŸÖ ÿπÿ¨ŸÖÿßŸÜ",
        "ŸÜÿßÿ¶ÿ® ÿ±ÿ¶Ÿäÿ≥ ÿßŸÑÿØŸàŸÑÿ©",
        "ÿ±ÿ¶Ÿäÿ≥ ÿßŸÑŸàÿ≤ÿ±ÿßÿ°",

        // Core National & Pride Terms
        "ÿßŸÑŸàÿ∑ŸÜ",
        "ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™",
        "ÿØÿ®Ÿä",
        "ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä",
        "ÿßŸÑÿ¥ÿßÿ±ŸÇÿ©",
        "ÿßŸÑŸÅÿ¨Ÿäÿ±ÿ©",
        "ÿ±ÿ£ÿ≥ ÿßŸÑÿÆŸäŸÖÿ©",
        "ÿπÿ¨ŸÖÿßŸÜ",
        "ÿ£ŸÖ ÿßŸÑŸÇŸäŸàŸäŸÜ",
        "ÿßŸÑÿ¥ŸáÿØÿßÿ°",
        "ÿßŸÑÿ¨ŸÜŸàÿØ",
        "ÿßŸÑŸÖŸàÿßÿ∑ŸÜŸäŸÜ",
        "ÿ¥ÿπÿ® ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™",
        "ÿßŸÑÿ¢ÿ®ÿßÿ° ÿßŸÑŸÖÿ§ÿ≥ÿ≥ŸäŸÜ",
        "ÿßŸÑÿπŸÑŸÖ",
        "ÿßŸÑÿ±ÿßŸäÿ©",
        "ÿßŸÑŸÖÿ¨ÿØ",
        "ÿßŸÑŸÅÿÆÿ±",
        "ÿßŸÑŸÉÿ±ÿßŸÖÿ©",
        "ÿßŸÑŸàŸÅÿß",
        "ÿßŸÑÿπÿ±Ÿàÿ®ÿ©",
        "ÿßŸÑÿ£ŸÖŸÑ",
        "ÿßŸÑÿ≤ŸÖŸÜ",

        // Common Poetic Words / Love Language
        "ÿ≠ÿ®",
        "ÿπÿ¥ŸÇ",
        "ŸÇŸÑÿ®",
        "ÿßŸÑÿπŸäŸàŸÜ",
        "ÿßŸÑÿ¥ŸàŸÇ",
        "ÿßŸÑÿ∫ŸÑÿß",
        "ÿßŸÑŸáÿ¨ÿ±",
        "ÿßŸÑŸÅÿ±ÿßŸÇ",
        "ÿßŸÑŸàÿµŸÑ",
        "ÿßŸÑŸáŸàŸâ",
        "ÿßŸÑÿ∫ÿ±ÿßŸÖ",
        "ÿßŸÑŸÖÿ≠ÿ®ŸäŸÜ",
        "ÿßŸÑÿßÿ¥ŸàÿßŸÇ",
        "ÿßŸÑÿ≠ŸÜŸäŸÜ",
        "ÿßŸÑŸàÿ¨ÿØ",
        "ÿßŸÑŸÑŸàÿπÿ©",
        "ÿßŸÑÿ¥ÿ¨ŸÜ",
        "ÿßŸÑÿ¨ÿ±Ÿàÿ≠",
        "ÿßŸÑÿ£ŸÑŸÖ",
        "ÿßŸÑÿØŸÖŸàÿπ",
        "ÿßŸÑÿ≠ÿ≤ŸÜ",
        "ÿßŸÑŸÖÿ≠ÿßŸÜŸä",
        "ÿßŸÑÿπÿ∞ÿßŸÑ",
        "ÿßŸÑÿµÿØ",
        "ÿßŸÑŸáÿ¨ÿ±ÿßŸÜ",
        "ÿßŸÑŸÖŸÑÿßŸÖ",

        // Key Events & Cultural Terms
        "ŸäŸàŸÖ ÿßŸÑÿ¥ŸáŸäÿØ",
        "ÿßŸÑŸäŸàŸÖ ÿßŸÑŸàÿ∑ŸÜŸä",
        "ŸäŸàŸÖ ÿßŸÑÿπŸÑŸÖ",
        "ŸäŸàŸÖ ÿßŸÑÿßÿ™ÿ≠ÿßÿØ",
        "ÿ±ŸÖÿ∂ÿßŸÜ",
        "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
        "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ",
        "ŸäŸàŸÖ ÿπÿ±ŸÅÿ©",
        "ÿ±ÿ£ÿ≥ ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸáÿ¨ÿ±Ÿäÿ©",
        "ÿßŸÑŸÖŸàŸÑÿØ ÿßŸÑŸÜÿ®ŸàŸä",
        "ŸäŸàŸÖ ÿßŸÑÿ£ŸÖ",
        "ÿ™ÿ≠ÿØŸä ÿØÿ®Ÿä ŸÑŸÑŸäÿßŸÇÿ©",
        "ŸÖŸáÿ±ÿ¨ÿßŸÜ ÿØÿ®Ÿä ŸÑŸÑÿ™ÿ≥ŸàŸÇ",
        "ŸÖŸÅÿßÿ¨ÿ¢ÿ™ ÿØÿ®Ÿä ÿßŸÑÿµŸäŸÅŸäÿ©",
        "ŸÖÿπÿ±ÿ∂ ÿØÿ®Ÿä ŸÑŸÑÿ∑Ÿäÿ±ÿßŸÜ",
        "ÿ¨ÿßÿ¶ÿ≤ÿ© ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä ÿßŸÑŸÉÿ®ÿ±Ÿâ",
        "ŸÉÿ£ÿ≥ ÿØÿ®Ÿä ÿßŸÑÿπÿßŸÑŸÖŸä",
        "expo 2020",

        // Pan-Arab / Regional References
        "ŸÖÿµÿ±",
        "ŸÅŸÑÿ≥ÿ∑ŸäŸÜ",
        "ÿßŸÑŸÖÿ∫ÿ±ÿ®",
        "ÿ®ÿ∫ÿØÿßÿØ",
        "ÿßŸÑÿ¥ÿßŸÖ",
        "ÿ≥ŸÑŸÖÿßŸÜ",
        "ÿ™ŸÖŸäŸÖ",
        "ÿ≠ŸÖÿØ",
        "ŸÖÿ¥ÿπŸÑ",
        "ŸáŸäÿ´ŸÖ",
        "ŸÖÿ≠ŸÖÿØ ÿ®ŸÜ ÿ≥ŸÑŸÖÿßŸÜ",
        "MBS",

        // Miscellaneous Boosters from Poetry Style
        "ŸÑŸäŸÑ",
        "ÿßŸÑÿπÿ∑ÿ±",
        "ÿßŸÑÿπÿ¥ŸÇ",
        "ÿßŸÑÿ±Ÿàÿ≠",
        "ÿßŸÑÿ≠Ÿäÿßÿ©",
        "ÿßŸÑÿØŸÜŸäÿß",
        "ÿßŸÑÿµÿ®ÿ±",
        "ÿßŸÑÿ£ŸÖŸÑ",
        "ÿßŸÑŸÖÿ¨ÿØ",
        "ÿßŸÑÿ≥ŸÖÿßÿ°",
        "ÿßŸÑÿ£ÿ±ÿ∂",
        "ÿßŸÑŸáŸàÿßÿ°",
        "ÿßŸÑÿ´ÿ±ÿß",
        "ÿßŸÑŸÖÿßÿ°",
        "ÿßŸÑÿ®ÿ≠ÿ±",
        "ÿßŸÑÿ¥ŸÖÿ≥",
        "ÿßŸÑŸÇŸÖÿ±",
      ];

      // Latin to Arabic mapping
      const LATIN_TO_ARABIC = {
        // Names & Family
        mohamed: "ŸÖÿ≠ŸÖÿØ",
        mohammad: "ŸÖÿ≠ŸÖÿØ",
        ahmed: "ÿ£ÿ≠ŸÖÿØ",
        hmd: "ÿ≠ŸÖÿØ",
        hamdan: "ÿ≠ŸÖÿØÿßŸÜ",
        hind: "ŸáŸÜÿØ",
        sheikha: "ÿ¥ŸäÿÆÿ©",
        mktoum: "ŸÖŸÉÿ™ŸàŸÖ",
        bin: "ÿ®ŸÜ",
        ibn: "ÿ®ŸÜ",

        // Leadership & Royalty
        mbz: "ŸÖÿ≠ŸÖÿØ ÿ®ŸÜ ÿ≤ÿßŸäÿØ",
        zayed: "ÿ≤ÿßŸäÿØ",
        zxayed: "ÿ≤ÿßŸäÿØ",
        khalifa: "ÿÆŸÑŸäŸÅÿ©",
        saud: "ÿ≥ÿπŸàÿØ",
        saqr: "ÿµŸÇÿ±",
        hamid: "ÿ≠ŸÖŸäÿØ",
        rashid: "ÿ±ÿßÿ¥ÿØ",
        "rashid bin said": "ÿ±ÿßÿ¥ÿØ ÿ®ŸÜ ÿ≥ÿπŸäÿØ",
        "maktoum bin rashid": "ŸÖŸÉÿ™ŸàŸÖ ÿ®ŸÜ ÿ±ÿßÿ¥ÿØ",
        "zayed bin sultan": "ÿ≤ÿßŸäÿØ ÿ®ŸÜ ÿ≥ŸÑÿ∑ÿßŸÜ",
        "ruler of dubai": "ÿ≠ÿßŸÉŸÖ ÿØÿ®Ÿä",
        "ruler of abu dhabi": "ÿ≠ÿßŸÉŸÖ ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä",
        "ruler of sharjah": "ÿ≠ÿßŸÉŸÖ ÿßŸÑÿ¥ÿßÿ±ŸÇÿ©",
        "ruler of fujairah": "ÿ≠ÿßŸÉŸÖ ÿßŸÑŸÅÿ¨Ÿäÿ±ÿ©",
        "ruler of ras al khaimah": "ÿ≠ÿßŸÉŸÖ ÿ±ÿ£ÿ≥ ÿßŸÑÿÆŸäŸÖÿ©",
        "ruler of ajman": "ÿ≠ÿßŸÉŸÖ ÿπÿ¨ŸÖÿßŸÜ",
        "vice president": "ŸÜÿßÿ¶ÿ® ÿ±ÿ¶Ÿäÿ≥ ÿßŸÑÿØŸàŸÑÿ©",
        "prime minister": "ÿ±ÿ¶Ÿäÿ≥ ÿßŸÑŸàÿ≤ÿ±ÿßÿ°",

        // National & Cultural terms
        home: "ÿßŸÑŸàÿ∑ŸÜ",
        uae: "ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™",
        dubai: "ÿØÿ®Ÿä",
        abudhabi: "ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä",
        sharjah: "ÿßŸÑÿ¥ÿßÿ±ŸÇÿ©",
        fujairah: "ÿßŸÑŸÅÿ¨Ÿäÿ±ÿ©",
        "ras alkhaimah": "ÿ±ÿ£ÿ≥ ÿßŸÑÿÆŸäŸÖÿ©",
        ajman: "ÿπÿ¨ŸÖÿßŸÜ",
        "um alqaiwain": "ÿ£ŸÖ ÿßŸÑŸÇŸäŸàŸäŸÜ",
        martyrs: "ÿßŸÑÿ¥ŸáÿØÿßÿ°",
        soldiers: "ÿßŸÑÿ¨ŸÜŸàÿØ",
        people: "ÿ¥ÿπÿ® ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™",
        "founding father": "ÿßŸÑÿ¢ÿ®ÿßÿ° ÿßŸÑŸÖÿ§ÿ≥ÿ≥ŸäŸÜ",
        flag: ["ÿßŸÑÿπŸÑŸÖ", "ÿßŸÑÿ±ÿßŸäÿ©"],
        glory: ["ÿßŸÑŸÖÿ¨ÿØ"],
        pride: ["ÿßŸÑŸÅÿÆÿ±"],
        dignity: ["ÿßŸÑŸÉÿ±ÿßŸÖÿ©"],
        loyalty: ["ÿßŸÑŸàŸÅÿß"],
        arob: ["ÿßŸÑÿπÿ±Ÿàÿ®ÿ©"],
        hope: ["ÿßŸÑÿ£ŸÖŸÑ"],
        time: ["ÿßŸÑÿ≤ŸÖŸÜ"],

        // Poetic / love
        love: "ÿ≠ÿ®",
        passion: "ÿπÿ¥ŸÇ",
        heart: "ŸÇŸÑÿ®",
        eyes: "ÿßŸÑÿπŸäŸàŸÜ",
        longing: "ÿßŸÑÿ¥ŸàŸÇ",
        affection: "ÿßŸÑÿ∫ŸÑÿß",
        separation: "ÿßŸÑŸáÿ¨ÿ±",
        parting: "ÿßŸÑŸÅÿ±ÿßŸÇ",
        union: "ÿßŸÑŸàÿµŸÑ",
        desire: "ÿßŸÑŸáŸàŸâ",
        romance: "ÿßŸÑÿ∫ÿ±ÿßŸÖ",
        lovers: "ÿßŸÑŸÖÿ≠ÿ®ŸäŸÜ",
        longings: "ÿßŸÑÿßÿ¥ŸàÿßŸÇ",
        nostalgia: "ÿßŸÑÿ≠ŸÜŸäŸÜ",
        existence: "ÿßŸÑŸàÿ¨ÿØ",
        anguish: "ÿßŸÑŸÑŸàÿπÿ©",
        melancholy: "ÿßŸÑÿ¥ÿ¨ŸÜ",
        wounds: "ÿßŸÑÿ¨ÿ±Ÿàÿ≠",
        pain: "ÿßŸÑÿ£ŸÑŸÖ",
        sorrow: "ÿßŸÑÿ≠ÿ≤ŸÜ",
        afflictions: "ÿßŸÑŸÖÿ≠ÿßŸÜŸä",
        reproaches: "ÿßŸÑÿπÿ∞ÿßŸÑ",
        rejection: "ÿßŸÑÿµÿØ",
        abandonment: "ÿßŸÑŸáÿ¨ÿ±ÿßŸÜ",
        reproach: "ÿßŸÑŸÖŸÑÿßŸÖ",
        night: "ŸÑŸäŸÑ",
        perfume: "ÿßŸÑÿπÿ∑ÿ±",
        soul: "ÿßŸÑÿ±Ÿàÿ≠",
        life: "ÿßŸÑÿ≠Ÿäÿßÿ©",
        world: "ÿßŸÑÿØŸÜŸäÿß",

        // Events & holidays
        "martyrs day": "ŸäŸàŸÖ ÿßŸÑÿ¥ŸáŸäÿØ",
        "national day": "ÿßŸÑŸäŸàŸÖ ÿßŸÑŸàÿ∑ŸÜŸä",
        "flag day": "ŸäŸàŸÖ ÿßŸÑÿπŸÑŸÖ",
        "union day": "ŸäŸàŸÖ ÿßŸÑÿßÿ™ÿ≠ÿßÿØ",
        ramadan: "ÿ±ŸÖÿ∂ÿßŸÜ",
        "eid al fitr": "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±",
        "eid al adha": "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ",
        "arafah day": "ŸäŸàŸÖ ÿπÿ±ŸÅÿ©",
        "hijri new year": "ÿ±ÿ£ÿ≥ ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸáÿ¨ÿ±Ÿäÿ©",
        "mawlid al nabawi": "ÿßŸÑŸÖŸàŸÑÿØ ÿßŸÑŸÜÿ®ŸàŸä",
        "mothers day": "ŸäŸàŸÖ ÿßŸÑÿ£ŸÖ",

        "dubai fitness challenge": "ÿ™ÿ≠ÿØŸä ÿØÿ®Ÿä ŸÑŸÑŸäÿßŸÇÿ©",
        "dubai shopping festival": "ŸÖŸáÿ±ÿ¨ÿßŸÜ ÿØÿ®Ÿä ŸÑŸÑÿ™ÿ≥ŸàŸÇ",
        "dubai summer surprises": "ŸÖŸÅÿßÿ¨ÿ¢ÿ™ ÿØÿ®Ÿä ÿßŸÑÿµŸäŸÅŸäÿ©",
        "dubai airshow": "ŸÖÿπÿ±ÿ∂ ÿØÿ®Ÿä ŸÑŸÑÿ∑Ÿäÿ±ÿßŸÜ",
        "abu dhabi grand prix": "ÿ¨ÿßÿ¶ÿ≤ÿ© ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä ÿßŸÑŸÉÿ®ÿ±Ÿâ",
        "dubai world cup": "ŸÉÿ£ÿ≥ ÿØÿ®Ÿä ÿßŸÑÿπÿßŸÑŸÖŸä",
        expo2020: "expo 2020",

        // Pan-Arab / Regional (UAE-relevant)
        egypt: "ŸÖÿµÿ±",
        palestine: "ŸÅŸÑÿ≥ÿ∑ŸäŸÜ",
        morocco: "ÿßŸÑŸÖÿ∫ÿ±ÿ®",
        baghdad: "ÿ®ÿ∫ÿØÿßÿØ",
        sham: "ÿßŸÑÿ¥ÿßŸÖ",

        // GCC (Closest to UAE)
        uae: "ÿßŸÑÿ•ŸÖÿßÿ±ÿßÿ™",
        dubai: "ÿØÿ®Ÿä",
        abu_dhabi: "ÿ£ÿ®Ÿàÿ∏ÿ®Ÿä",
        sharjah: "ÿßŸÑÿ¥ÿßÿ±ŸÇÿ©",

        saudi: "ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©",
        ksa: "ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©",
        riyadh: "ÿßŸÑÿ±Ÿäÿßÿ∂",
        jeddah: "ÿ¨ÿØÿ©",

        oman: "ÿπŸèŸÖÿßŸÜ",
        muscat: "ŸÖÿ≥ŸÇÿ∑",

        kuwait: "ÿßŸÑŸÉŸàŸäÿ™",

        qatar: "ŸÇÿ∑ÿ±",
        doha: "ÿßŸÑÿØŸàÿ≠ÿ©",

        bahrain: "ÿßŸÑÿ®ÿ≠ÿ±ŸäŸÜ",
        manama: "ÿßŸÑŸÖŸÜÿßŸÖÿ©",

        // Nearby Arab states with strong relation
        jordan: "ÿßŸÑÿ£ÿ±ÿØŸÜ",
        amman: "ÿπŸÖŸëÿßŸÜ",

        iraq: "ÿßŸÑÿπÿ±ÿßŸÇ",
        basra: "ÿßŸÑÿ®ÿµÿ±ÿ©",

        syria: "ÿ≥Ÿàÿ±Ÿäÿß",
        damascus: "ÿØŸÖÿ¥ŸÇ",

        lebanon: "ŸÑÿ®ŸÜÿßŸÜ",
        beirut: "ÿ®Ÿäÿ±Ÿàÿ™",

        yemen: "ÿßŸÑŸäŸÖŸÜ",
        sanaa: "ÿµŸÜÿπÿßÿ°",

        // North Africa (frequent cultural ties)
        tunisia: "ÿ™ŸàŸÜÿ≥",
        algeria: "ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±",
        libya: "ŸÑŸäÿ®Ÿäÿß",
        sudan: "ÿßŸÑÿ≥ŸàÿØÿßŸÜ",

        salman: "ÿ≥ŸÑŸÖÿßŸÜ",
        tamim: "ÿ™ŸÖŸäŸÖ",
        mishal: "ŸÖÿ¥ÿπŸÑ",
        haitham: "ŸáŸäÿ´ŸÖ",
        "mohamed bin salman": "ŸÖÿ≠ŸÖÿØ ÿ®ŸÜ ÿ≥ŸÑŸÖÿßŸÜ",
        mbs: "MBS",

        // Elements / natural
        perfume: "ÿßŸÑÿπÿ∑ÿ±",
        love: "ÿßŸÑÿπÿ¥ŸÇ",
        soul: "ÿßŸÑÿ±Ÿàÿ≠",
        life: "ÿßŸÑÿ≠Ÿäÿßÿ©",
        world: "ÿßŸÑÿØŸÜŸäÿß",
        patience: "ÿßŸÑÿµÿ®ÿ±",
        hope: "ÿßŸÑÿ£ŸÖŸÑ",
        sky: "ÿßŸÑÿ≥ŸÖÿßÿ°",
        earth: "ÿßŸÑÿ£ÿ±ÿ∂",
        air: "ÿßŸÑŸáŸàÿßÿ°",
        soil: "ÿßŸÑÿ´ÿ±ÿß",
        water: "ÿßŸÑŸÖÿßÿ°",
        sea: "ÿßŸÑÿ®ÿ≠ÿ±",
        sun: "ÿßŸÑÿ¥ŸÖÿ≥",
        moon: "ÿßŸÑŸÇŸÖÿ±",
      };

      // ============================================================
      // STATE
      // ============================================================
      let flexIndex = null;
      let poemsData = [];
      let debounceTimer = null;

      const searchInput = document.getElementById("searchInput");
      const clearBtn = document.getElementById("clearBtn");
      const resultsDiv = document.getElementById("results");
      const statusDiv = document.getElementById("status");

      // ============================================================
      // ARABIC NORMALIZATION
      // ============================================================
      function normalize(text) {
        if (!text) return "";
        return String(text)
          .replace(/[\u0610-\u061A\u064B-\u065F\u06D6-\u06ED]/g, "")
          .replace(/\u0640/g, "")
          .replace(/[ÿ•ÿ£ÿ¢ÿß]/g, "ÿß")
          .replace(/Ÿâ/g, "Ÿä")
          .replace(/[ÿ§ÿ¶]/g, "ÿ°")
          .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()ÿüŸ¨¬´¬ª"""''\-‚Äì‚Äî]/g, " ")
          .replace(/\s+/g, " ")
          .trim();
      }

      function mapLatinToArabic(query) {
        const tokens = query.toLowerCase().split(/\s+/);
        return tokens.map((t) => LATIN_TO_ARABIC[t] || t).join(" ");
      }

      // ============================================================
      // CSV LOADER
      // ============================================================
      async function loadCSV(path) {
        const response = await fetch(path);
        if (!response.ok) throw new Error(`Failed to load ${path}`);

        const text = await response
          .text()
          .then((t) => t.replace(/^\uFEFF/, ""));
        const lines = text.trim().split(/\r?\n/);

        if (lines.length < 2) throw new Error("CSV is empty");

        const headers = lines[0].split(",").map((h) => h.trim());
        const rows = [];

        let i = 1;
        while (i < lines.length) {
          let currentLine = lines[i];
          let parts = [];
          let current = "";
          let inQuotes = false;

          // Handle multi-line quoted fields
          while (i < lines.length) {
            for (let j = 0; j < currentLine.length; j++) {
              const char = currentLine[j];

              if (char === '"') {
                if (inQuotes && currentLine[j + 1] === '"') {
                  current += '"';
                  j++;
                } else {
                  inQuotes = !inQuotes;
                }
              } else if (char === "," && !inQuotes) {
                parts.push(current);
                current = "";
              } else {
                current += char;
              }
            }

            if (inQuotes) {
              current += "\n";
              i++;
              if (i < lines.length) {
                currentLine = lines[i];
              } else {
                break;
              }
            } else {
              parts.push(current);
              break;
            }
          }

          // NEW CSV has: poem_id, Row_ID, Title_raw, Poem_line_raw, summary, Title_cleaned, Poem_line_cleaned, ...
          if (parts.length >= 7) {
            rows.push({
              poem_id: parts[0]?.trim(),
              Row_ID: parts[1]?.trim(),
              Title_raw: parts[2]?.trim(),
              Poem_line_raw: parts[3]?.trim(),
              summary: parts[4]?.trim(),
              Title_cleaned: parts[5]?.trim(),
              Poem_line_cleaned: parts[6]?.trim(),
            });
          }

          i++;
        }

        console.log(`‚úÖ Parsed ${rows.length} lines`);
        return { headers, rows };
      }

      // ============================================================
      // INDEX BUILDER
      // ============================================================
      function buildIndex(rows) {
        poemsData = rows.map((r, idx) => ({
          idx: idx,
          poem_id: r.poem_id || "",
          row_id: r.Row_ID || "",
          title_raw: r.Title_raw || "",
          line_raw: r.Poem_line_raw || "",
          summary: r.summary || "",
          title_clean: normalize(r.Title_cleaned || r.Title_raw || ""),
          line_clean: normalize(r.Poem_line_cleaned || r.Poem_line_raw || ""),
        }));

        // GROUP lines by poem_id
        const poemGroups = {};
        poemsData.forEach((line) => {
          if (!poemGroups[line.poem_id]) {
            poemGroups[line.poem_id] = {
              poem_id: line.poem_id,
              title_raw: line.title_raw,
              lines: [],
            };
          }
          poemGroups[line.poem_id].lines.push(line.line_raw);
        });

        // Store grouped poems globally
        window.poemsGrouped = poemGroups;

        const uniquePoems = Object.keys(poemGroups).length;
        console.log(`‚úÖ Loaded ${rows.length} lines from ${uniquePoems} poems`);

        // Build FlexSearch index
        flexIndex = new FlexSearch.Document({
          document: {
            id: "idx",
            store: [
              "poem_id",
              "row_id",
              "title_raw",
              "line_raw",
              "summary",
              "title_clean",
              "line_clean",
            ],
            index: [
              { field: "title_clean", tokenize: "forward", weight: 3 },
              { field: "line_clean", tokenize: "forward", weight: 1 },
            ],
          },
          tokenize: "forward",
          cache: true,
        });

        poemsData.forEach((doc) => flexIndex.add(doc));
      }
      console.log(`‚úÖ Indexed ${poemsData.length} poems`);

      // ============================================================
      // SEARCH ENGINE - ADAPTED FROM WORKING FUZZY_SEARCH.HTML
      // ============================================================
      function search(rawQuery) {
        if (!rawQuery.trim()) return [];

        // MAP LATIN TO ARABIC FIRST (like old fuzzy_search.html)
        const arabicQuery = mapLatinToArabic(rawQuery);
        const normQuery = normalize(arabicQuery);

        console.log("Original query:", rawQuery);
        console.log("Arabic query:", arabicQuery);
        console.log("Normalized query:", normQuery);

        const rawResults = flexIndex.search(normQuery, {
          enrich: true,
          limit: 500,
          suggest: true,
        });

        const candidateMap = new Map();
        rawResults.forEach((bucket) => {
          if (bucket.result) {
            bucket.result.forEach((r) => {
              if (!candidateMap.has(r.id)) {
                candidateMap.set(r.id, r.doc);
              }
            });
          }
        });

        const candidates = Array.from(candidateMap.values());

        // EXACT SCORING FROM WORKING VERSION
        const scored = candidates.map((doc) => {
          let score = 0;
          const title = doc.title_clean || "";
          const line = doc.line_clean || "";

          const titleTokens = title.split(" ").filter(Boolean);
          const lineTokens = line.split(" ").filter(Boolean);

          if (titleTokens.includes(normQuery)) score += 120;
          if (lineTokens.includes(normQuery)) score += 80;

          if (title.indexOf(normQuery) !== -1) score += 60;
          if (line.indexOf(normQuery) !== -1) score += 30;

          if (title.startsWith(normQuery)) score += 40;
          if (line.startsWith(normQuery)) score += 20;

          let boostCount = 0;
          for (const w of BOOSTED_WORDS) {
            if (!w) continue;
            const nw = normalize(w);
            if (title.indexOf(nw) !== -1 || line.indexOf(nw) !== -1)
              boostCount++;
          }
          score += boostCount * 8;

          score -= Math.abs((title.length || 0) - normQuery.length) * 0.5;

          if (
            normQuery.length >= 2 &&
            title.length < normQuery.length &&
            line.length < normQuery.length
          ) {
            score -= 8;
          }

          return { doc, score };
        });

        scored.sort((a, b) => b.score - a.score);

        const resultsPerPoem = new Map();
        const limitedResults = [];

        for (const item of scored) {
          const poemId = item.doc.poem_id;
          const count = resultsPerPoem.get(poemId) || 0;

          if (count < 2) {
            limitedResults.push(item.doc);
            resultsPerPoem.set(poemId, count + 1);
          }

          if (limitedResults.length >= 10) break;
        }

        return limitedResults;
      }

      // ============================================================
      // ANALYTICS - ACCURATE COUNTING
      // ============================================================
      function getAnalytics(query) {
        if (!query.trim()) return { wordCount: 0, poemCount: 0 };

        const arabicQuery = mapLatinToArabic(query);
        const normQuery = normalize(arabicQuery);

        const uniquePoems = new Set();
        let totalOccurrences = 0;

        poemsData.forEach((doc) => {
          const title = doc.title_clean || "";
          const line = doc.line_clean || "";
          const combined = title + " " + line;

          if (combined.indexOf(normQuery) !== -1) {
            uniquePoems.add(doc.poem_id);
            const matches = (
              combined.match(
                new RegExp(
                  normQuery.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"),
                  "g"
                )
              ) || []
            ).length;
            totalOccurrences += matches;
          }
        });

        return {
          wordCount: totalOccurrences,
          poemCount: uniquePoems.size,
        };
      }

      // ============================================================
      // HIGHLIGHTING
      // ============================================================
      function escapeHtml(str) {
        if (!str) return "";
        return String(str)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function highlight(text, query) {
        if (!text || !query) return escapeHtml(text);

        const normTokens = normalize(query).split(/\s+/).filter(Boolean);
        let result = escapeHtml(text);

        normTokens.forEach((token) => {
          const pattern = Array.from(token)
            .map(
              (ch) =>
                ch + "[\\u0610-\\u061A\\u064B-\\u065F\\u06D6-\\u06ED\\u0640]*"
            )
            .join("");
          const regex = new RegExp(pattern, "gi");
          result = result.replace(regex, (match) => `<mark>${match}</mark>`);
        });

        return result;
      }

      // ============================================================
      // POETRY FORMATTING
      // ============================================================
      function wrapPoetryLine(highlightedText) {
        if (!highlightedText) return "";

        // Split by 4+ spaces
        const parts = highlightedText.split(/\s{4,}/);

        if (parts.length === 2) {
          return `<div class="poetry-line">
            <div class="hemistich hemistich-right">${parts[0].trim()}</div>
            <div class="hemistich hemistich-left">${parts[1].trim()}</div>
          </div>`;
        }

        return highlightedText;
      }

      // ============================================================
      // WIDGET
      // ============================================================
      function openPoemWidget(titleRaw, poemRaw, poemId, query) {
        const overlay = document.createElement("div");
        overlay.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7); z-index: 1000;
        display: flex; align-items: center; justify-content: center;
        padding: 20px;
    `;

        // Format each line in the poem
        const lines = poemRaw.split("\n");
        const formattedLines = lines
          .map((line) => wrapPoetryLine(highlight(line, query || "")))
          .join("");
        const highlightedTitle = highlight(titleRaw, query || "");

        overlay.innerHTML = `
        <div style="
            background: white; border-radius: 16px; padding: 32px;
            max-width: 900px; width: 90%; max-height: 80vh; overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        ">
            <h2 style="margin-bottom: 20px; font-size: 24px; color: #2c3e50; text-align: center;">${highlightedTitle}</h2>
            <div style="line-height: 2; font-size: 18px;">${formattedLines}</div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; font-size: 13px; color: #666; text-align: center;">
                ŸÇÿµŸäÿØÿ© #${poemId}
            </div>
            <button id="closeWidget" style="
                margin-top: 20px; padding: 12px 24px; border-radius: 8px;
                background: #3498db; color: white; border: none;
                cursor: pointer; font-size: 16px; display: block; margin: 20px auto 0;
            ">ÿ•ÿ∫ŸÑÿßŸÇ</button>
        </div>
    `;

        document.body.appendChild(overlay);

        // Scroll to first highlight if it exists
        setTimeout(() => {
          const firstMark = overlay.querySelector("mark");
          if (firstMark) {
            firstMark.scrollIntoView({ behavior: "smooth", block: "center" });
          }
        }, 100);

        overlay.addEventListener("click", (e) => {
          if (e.target === overlay || e.target.id === "closeWidget") {
            overlay.remove();
          }
        });
      }

      // ============================================================
      // UI RENDERING
      // ============================================================
      function displayResults(results, query) {
        if (!results || results.length === 0) {
          resultsDiv.innerHTML = '<div class="no-results">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨</div>';
          return;
        }

        const analytics = getAnalytics(query);
        const arabicQuery = mapLatinToArabic(query);
        const normQuery = normalize(arabicQuery);

        const analyticsHTML = `
        <div style="background: white; border: 1px solid var(--border); border-radius: 10px; padding: 12px 16px; margin-bottom: 16px; display: flex; gap: 20px;">
            <div><span style="color: var(--muted);">ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨:</span> <strong>${results.length}</strong></div>
            <div><span style="color: var(--muted);">ÿßŸÑŸÇÿµÿßÿ¶ÿØ:</span> <strong style="color: #2196F3;">${analytics.poemCount}</strong></div>
            <div><span style="color: var(--muted);">ÿßŸÑÿ™ŸÉÿ±ÿßÿ±ÿßÿ™:</span> <strong style="color: #4CAF50;">${analytics.wordCount}</strong></div>
        </div>
    `;

        const resultsHTML = results
          .map((r) => {
            const poem = window.poemsGrouped[r.poem_id];
            const totalLines = poem ? poem.lines.length : 0;

            // Find all matching line numbers in this poem
            const matchingLineNumbers = [];
            let occurrenceCount = 0;

            if (poem) {
              poem.lines.forEach((line, idx) => {
                const lineNorm = normalize(line);
                const matches = (
                  lineNorm.match(
                    new RegExp(
                      normQuery.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"),
                      "g"
                    )
                  ) || []
                ).length;
                if (matches > 0) {
                  matchingLineNumbers.push(idx + 1); // 1-indexed
                  occurrenceCount += matches;
                }
              });
            }

            const lineNumbersDisplay =
              matchingLineNumbers.length > 5
                ? matchingLineNumbers.slice(0, 5).join(", ") + "..."
                : matchingLineNumbers.join(", ");

            return `
            <div class="result" data-poem-id="${r.poem_id}">
                <div class="title">${highlight(r.title_raw, arabicQuery)}</div>
                <div class="poem-lines">${wrapPoetryLine(
                  highlight(r.line_raw, arabicQuery)
                )}</div>
                <div class="meta" style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <span class="badge">ŸÇÿµŸäÿØÿ© #${r.poem_id}</span>
                    <span class="badge" style="background: #e8f5e9; color: #2e7d32;">ÿ™ŸÉÿ±ÿßÿ±: ${occurrenceCount}</span>
                    <span class="badge" style="background: #fff3e0; color: #e65100;">ÿ≥ÿ∑ÿ±: ${lineNumbersDisplay}</span>
                    <span class="badge" style="background: #e3f2fd; color: #1565c0;">ÿ£ÿ≥ÿ∑ÿ±: ${totalLines}</span>
                </div>
            </div>
        `;
          })
          .join("");

        resultsDiv.innerHTML = analyticsHTML + resultsHTML;

        // Click handler - opens FULL POEM with highlights
        document.querySelectorAll(".result").forEach((el) => {
          el.addEventListener("click", function () {
            const poemId = this.getAttribute("data-poem-id");
            const poem = window.poemsGrouped[poemId];

            if (poem) {
              const fullPoem = poem.lines.join("\n");
              openPoemWidget(poem.title_raw, fullPoem, poemId, arabicQuery);
            }
          });
        });
      }
      // ============================================================
      // EVENT HANDLERS
      // ============================================================
      searchInput.addEventListener("input", (e) => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
          const query = e.target.value;
          if (!query.trim()) {
            resultsDiv.innerHTML = "";
            return;
          }
          const results = search(query);
          displayResults(results, query);
        }, DEBOUNCE_MS);
      });

      clearBtn.addEventListener("click", () => {
        searchInput.value = "";
        resultsDiv.innerHTML = "";
      });

      // ============================================================
      // INITIALIZATION
      // ============================================================
      (async function init() {
        try {
          statusDiv.textContent = "ÿ¨ÿßÿ±Ÿç ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿµÿßÿ¶ÿØ...";
          const { rows } = await loadCSV(CSV_FILE);
          buildIndex(rows);
          statusDiv.textContent = `‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${rows.length} ÿ≥ÿ∑ÿ± ŸÖŸÜ ${
            Object.keys(window.poemsGrouped).length
          } ŸÇÿµŸäÿØÿ©`;

          searchInput.disabled = false;
          clearBtn.disabled = false;
          searchInput.focus();
        } catch (error) {
          statusDiv.textContent = "‚ùå ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ: " + error.message;
          console.error(error);
        }
      })();
    </script>
  </body>
</html>
